# Решённое тестовое задание на Go-разработчика

Внизу этого документа приведена [исходная формулировка задачи](#Исходная-формулировка-задачи).

## Сборка сервиса

```bash
# склонировать этот репозиторий
git clone https://github.com/svkorch/mmine.git
```

Появится рабочая директория проекта.

```bash
# войти в неё
cd mmine/

# собрать проект
make # будет выполнено тестирование и сборка
# можно выполнить по отдельности
```

Программа вычитывает параметры конфигурации из переменных окружения.
Поэтому **следует сформировать надлежащую среду окружения**.

Программа способна сама формировать окружение при запуске, читая файл с именем `.env`. При желании можно задействовать этот способ.

```bash
cat << EOF > .env
LOG_LEVEL="info"
HTTP_SERVER_ADDR="0.0.0.0:8889"
EOF
```

## Упрощённый запуск сервиса

```bash
./bin/exchanges
```
В лог поступят первые записи. (Но это зависит от уровня логирования и различных непредвиденных обстоятельств.)

```
INFO[0000] `Exchanges' service is starting...
```

## Пример обращения к сервису

Здесь используется программа `curl`, но можно использовать и иные HTTP-клиенты, способные передавать данные в виде JSON. Например, `wget`.

```bash
curl --include --header "Content-Type: application/json" --data '{"amount": 400, "banknotes": [5000, 2000, 1000, 500, 200, 100, 50]}' "http://127.0.0.1:8889/exchange"; echo
```

```
INFO[0004] RemoteAddr: [127.0.0.1:41030]
INFO[0004] [1] amount: 400, banknotes: [5000 2000 1000 500 200 100 50]
INFO[0004] [2] amount: 400, banknotes: [5000 2000 1000 500 200 100 50]
INFO[0004] exchange of 400
INFO[0004] [[50 50 50 50 50 50 50 50] [100 50 50 50 50 50 50] [100 100 50 50 50 50] [100 100 100 50 50] [100 100 100 100] [200 50 50 50 50] [200 100 50 50] [200 100 100] [200 200]]
INFO[0004] {"exchanges":[[50,50,50,50,50,50,50,50],[100,50,50,50,50,50,50],[100,100,50,50,50,50],[100,100,100,50,50],[100,100,100,100],[200,50,50,50,50],[200,100,50,50],[200,100,100],[200,200]]}
```

## Остановка сервиса

Сервис может завершать работу аккуратно. Вместо внезапного останова, сервис способен обрабатывать сигналы `SIGTERM` и `SIGINT` и завершать работу по принципу `graceful shutdown`.

Остановить сервис, запущенный, как показано выше, можно просто нажатием комбинации клавиш `Ctrl` + `C`. В лог будут выведены соответствующие записи.

```
^CINFO[0436] stopping http server...
INFO[0436] http server has stopped gracefully
```

## Пример запуска unit-тестов алгоритма

```bash
make test
```

"Под капотом" будет выполнена команда:

```bash
go test -v -count=1 ./internal/lib/exchanger
```

Пример успешного теста:

```
=== RUN   TestExchangeOK
    exchanger_test.go:70: Number of items is 1
    exchanger_test.go:70: Number of items is 1
    exchanger_test.go:70: Number of items is 2
    exchanger_test.go:70: Number of items is 4
    exchanger_test.go:70: Number of items is 6
    exchanger_test.go:70: Number of items is 9
    exchanger_test.go:70: Number of items is 571
    exchanger_test.go:70: Number of items is 39857
--- PASS: TestExchangeOK (0.04s)
=== RUN   TestExchangeFail
--- PASS: TestExchangeFail (0.00s)
PASS
ok  	github.com/svkorch/mmine/internal/lib/exchanger	0.040s
```

---

## Исходная формулировка задачи

### Exchanges

Написать REST сервис по расчету всех вариантов размена для указанной суммы денег. На вход принимается HTTP запрос в формате:

```json
{
  "amount": 400,
  "banknotes": [
    5000,
    2000,
    1000,
    500,
    200,
    100,
    50
  ]
}
```

где
* **amount** – _сумма денег_
* **banknotes** – _доступные номиналы банкнот_

Формат ответа:

```json
{
  "exchanges": [
    [
      200,
      200
    ],
    [
      200,
      100,
      100
    ],
    [
      200,
      100,
      50,
      50
    ],
    [
      200,
      50,
      50,
      50,
      50
    ],
    [
      100,
      100,
      100,
      100
    ],
    [
      100,
      100,
      100,
      50,
      50
    ],
    [
      100,
      100,
      50,
      50,
      50,
      50
    ],
    [
      100,
      50,
      50,
      50,
      50,
      50,
      50
    ],
    [
      50,
      50,
      50,
      50,
      50,
      50,
      50,
      50
    ]
  ]
}
```

## Требования к оформлению

- конфигурация (хост, порт, уровень логирования)
- graceful shutdown
- unit тесты алгоритма
- оформлен в общедоступном git репозитории
